services:
    _defaults:
        autowire: true
        autoconfigure: true
        bind:
            array $supportedOutputFormats: [ 'jpeg', 'webp' ]

    App\:
        resource: '../src/'
        exclude:
            - '../src/Kernel.php'

    App\Controllers\:
        namespace: 'App\UseCase\'
        resource: '../src/UseCase/*/*Action.php'
        tags: [ { name: 'controller.service_arguments' } ]

    App\Core\Security\StringVault:
        arguments: [ '%env(APP_SECRET_KEYS)%' ]

    App\Core\Filesystem\FilesystemFileFactory:
        arguments: [ '%env(APP_FILESYSTEM_PATH)%' ]

    App\Core\ResizeStrategy\ImmutableResizeStrategyFactory:
        arguments: [ {
            'fixed': '@App\Core\ResizeStrategy\ResizeStrategyFixed',
        } ]

when@dev:
    services:
        App\Core\Security\ChecksumValidatorInterface: '@App\Core\Security\DisabledValidator'

when@prod:
    services:
        App\Core\Security\ChecksumValidatorInterface: '@App\Core\Security\HmacChecksumValidator'
